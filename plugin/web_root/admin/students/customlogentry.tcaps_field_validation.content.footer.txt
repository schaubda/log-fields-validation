<!-- Begin TCAPS Log Fields Validation Plugin -->
<script type="text/javascript">
    const FIELD_NAMES =
              {
                  'incidentDate':     'UF-008019-1',
                  'entryDate':        'UF-008005-1',
                  'reporterName':     'UF-008004-1',
                  'employeeID':       'UF-008025-1',
                  'logType':          'UF-008012-1$formatnumeric=#########.#####',
                  'subType':          'subtype',
                  'studentName':      'UF-008008-1',
                  'logDescription':   'UF-008009-1',
                  'incidentLocation': 'UF-008021-1',
                  'incidentTime':     'UF-008006-1'
              };

    function getFieldByName(name)
    {
        for (let key in FIELD_NAMES)
        {
            if (FIELD_NAMES[key] === name)
            {
                return key;
            }
        }

        return null;
    }

    (function ()
    {
        let selector = '';

        for (let key in FIELD_NAMES)
        {
            selector += `[name="${FIELD_NAMES[key]}"], `;
        }

        selector = selector.slice(0, -2);

        let inputFields = $j(selector);
        let fieldFuncs =
                {
                    'reporterName': 'validateReporterNameField',
                    'employeeID':   'validateReporterIDField'
                };

        inputFields.each(function (index, element)
                         {
                             let fieldName = getFieldByName($j(element).attr('name'));
                             let ignoredFields = ['subType', 'incidentLocation', 'incidentTime'];

                             if (!ignoredFields.includes(fieldName))
                             {
                                 $j(element).addClass('required');
                             }

                             if (fieldName in fieldFuncs)
                             {
                                 $j(element).addClass('psSpecialValidate');
                                 $j(element).attr('data-specialfunction', fieldFuncs[fieldName]);
                             }
                         });
    })();

    $j(function ()
       {
           let dateFields = $j('#content-main form div.box-round table:first :input')
               .slice(0, 2);

           dateFields.addClass('psDateWidget');

           logTypeChange();
           $j('#logtype').on('change', logTypeChange);
       });

    function validateReporterNameField(input)
    {
        let matchPattern = /.+, .+/;

        if (!matchPattern.test(input.val().trim()))
        {
            return 'This must be the reporter\'s name in the format "Last, First"';
        }
    }

    function validateReporterIDField(input)
    {
        let matchPattern = /^\d{5,7}$/;

        if (!matchPattern.test(input.val().trim()))
        {
            return 'This must be a valid employee number';
        }
    }

    function logTypeChange()
    {
        let logType = parseInt($j('#logtype').val());
        let incidentFields =
                $j(`[name="${FIELD_NAMES.incidentLocation}"], [name="${FIELD_NAMES.incidentTime}"]`);

        if (logType === -100000)
        {
            incidentFields.addClass('required');
        }
        else
        {
            incidentFields
                .each(function (index, element)
                      {
                          $j(element).removeClass('required unvalidated tagged hasHadError error');

                          if ($j(element).nextAll('.error-message').length > 0)
                          {
                              clearError($j(element));
                          }
                      });
        }

        initBehaviors();
    }
</script>
<!-- End TCAPS Log Fields Validation Plugin -->